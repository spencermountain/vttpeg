const t=/\d{2}(?:[:\.]\d{2,4})*/,e=/-->/;function n(t){const e=t.split(":"),n=parseInt(e[0],10),r=parseInt(e[1],10);let s=0,i=0;if(e[2]){const t=e[2].split(".");s=parseInt(t[0],10),t[1]&&(i=parseInt(t[1],10))}return 3600*n+60*r+s+i/1e3}const r=(t,e)=>t.map(t=>(t.startTime+=e,t.endTime+=e,t));class s{constructor(r=""){this.entries=function(r){const s=r.trim().split("\n");if(!s[0].includes("WEBVTT"))throw new Error("Invalid WebVTT format");const i=[];let o=null,l=!1;for(let r=1;r<s.length;r++){const u=s[r].trim();if(u)if(e.test(u)&&t.test(u)){l&&o&&i.push(o);let[t,e]=u.split("--\x3e");t=n(t.trim()),e=n(e.trim()),o={startTime:t,endTime:e,text:[]},l=!0}else l&&o&&o.text.push(u)}return l&&o&&i.push(o),i}(r)}json(){return this.entries}text(){return this.entries.map(t=>t.text).join("\n")}out(){return(t=>{let e="WEBVTT\n\n";for(let n=0;n<t.length;n++){let r=t[n];e+=`${r.startTime} --\x3e ${r.endTime}\n`,e+=`${r.text.join("\n")}\n\n`}return e})(this.entries)}debug(){console.log("--------------------------------"),console.log(this.entries),console.log(this.stats()),console.log("--------------------------------")}stats(){return(t=>{let e=t.map(t=>t.text.join("\n")).join("\n").split(" ").length,n=t.reduce((t,e)=>t+e.endTime-e.startTime,0);return{duration:n,entries:t.length,wordCount:e,wordsPerMinute:e/n*60}})(this.entries)}lint(t={}){return((t,e={})=>{e.silent=e.silent||!1;let n=[];for(let e=0;e<t.length;e+=1){let r=t[e];r.startTime>=r.endTime&&n.push(`StartTime is greater than EndTime for entry ${e}`),0===r.text.length&&n.push(`Text is empty for entry ${e}`),r.text.length>100&&n.push(`Text is too long for entry ${e}`)}return n.length>0?e.silent||(console.log("Lint errors: "),console.log(n)):e.silent||console.log("No lint errors found"),n})(this.entries,t)}isValid(t={}){return((t,e={})=>{e.silent=e.silent||!1;let n=[];t&&0!==t.length||n.push("No entries found");for(let e=0;e<t.length;e+=1){let r=t[e];("number"!=typeof r.startTime||r.startTime<0)&&n.push(`Invalid start time for entry ${e}`),("number"!=typeof r.endTime||r.endTime<0)&&n.push(`Invalid end time for entry ${e}`),r.startTime>=r.endTime&&n.push(`Start time is greater than end time for entry ${e}`)}return!(n.length>0&&(e.silent||(console.log("\n\n--------------------------------"),console.log("Validation errors: "),console.log(n),console.log("--------------------------------\n\n")),1))})(this.entries,t)}shift(t){return r(this.entries,t)}shiftLeft(t){return r(this.entries,-t)}shiftRight(t){return r(this.entries,t)}sort(){return this.entries.sort((t,e)=>t.startTime-e.startTime)}gaps(){return((t,e={})=>{const n=e.minGapSeconds||5,r=e.minSceneDuration||30;if(0===t.length)return[];const s=[];for(let e=0;e<t.length-1;e++){const i=t[e],o=t[e+1],l=o.startTime-i.endTime;if(l>=n){const t=i.endTime+l/2;(0===s.length||t-s[s.length-1]>=r)&&s.push({startTime:i.endTime,midpoint:t,endTime:o.startTime,duration:l})}}return s})(this.entries)}firstEntry(){return this.entries[0]}lastEntry(){return this.entries[this.entries.length-1]}duration(){return this.lastEntry().endTime-this.firstEntry().startTime}}const i=function(t=""){return new s(t)};i.fromElement=function(t){let e=t.querySelector("track");if(!e)throw new Error("No vtt file found");return console.log(e),i(e.textContent)};export{i as default};
