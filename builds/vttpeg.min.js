!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).vttpeg=t()}(this,function(){"use strict";const e=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},t=function(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&lrm;/g,"").replace(/&rlm;/g,"").replace(/&nbsp;/g," ").replace(/&ndash;/g,"–").replace(/&mdash;/g,"—").replace(/&copy;/g,"©").replace(/&reg;/g,"®").replace(/&trade;/g,"™").replace(/&asymp;/g,"≈").replace(/&ne;/g,"≠").replace(/&pound;/g,"£").replace(/&euro;/g,"€").replace(/&deg;/g,"°")};function r(e){let t=0,r=0,n=0,i=0,[s,l]=e.split("."),o=s.split(":");return n=parseInt(o.pop()||"0",10),r=parseInt(o.pop()||"0",10),t=parseInt(o.pop()||"0",10),i=parseInt(l||"0",10),3600*t+60*r+n+i/1e3}const n=function(e){let[t,n]=e.split("--\x3e"),i=r(t.trim()),s=n.trim().split(/^([0-9:.]+)(.*)/),l={startTime:i,endTime:r(s[1]),text:[]};return s[2]&&(l.attributes=s[2].trim()),l},i=/-->/,s=(e,t)=>e.map(e=>(e.startTime+=t,e.endTime+=t,e)),l=e=>e.toString().padStart(2,"0"),o=e=>{let t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=parseInt(e%60,10),i=Math.floor(e%1*1e3);return`${l(t)}:${l(r)}:${l(n)}.${s=i,s.toString().padEnd(3,"0")}`;var s},a=function(e){return e.replace(/<[^>]*>/g,"")};class u{constructor(e=""){this.entries=function(e){const r=e.trim().split("\n");if(!r[0].includes("WEBVTT"))throw new Error("Invalid WebVTT format");const s=[];let l=null,o=null;for(let e=1;e<r.length;e++){const a=r[e].trim();a?i.test(a)?(l=n(a),o&&(l.label=o,o=null)):l?l.text.push(t(a)):o=a.trim():(l&&s.push(l),l=null)}return l&&s.push(l),s}(e)}json(){return this.entries}text(){return this.entries.map(e=>e.text.join("\n")).join("\n")}plainText(){return this.entries.map(e=>e.text.map(e=>a(e)).join("\n")).join("\n")}out(){return(t=>{let r="WEBVTT\n\n";for(let n=0;n<t.length;n++){let i=t[n];i.label&&(r+=`${i.label}\n`),r+=`${o(i.startTime)} --\x3e ${o(i.endTime)}\n`,r+=`${i.text.map(e).join("\n")}\n\n`}return r.trim()})(this.entries)}debug(){console.log("--------------------------------"),console.log(this.entries),console.log(this.stats()),console.log("--------------------------------")}stats(){let e=(e=>{let t=e.reduce((e,t)=>e+t.endTime-t.startTime,0),r=e.reduce((e,t)=>e<t.endTime-t.startTime?e:t.endTime-t.startTime,e[0].endTime-e[0].startTime),n=e.reduce((e,t)=>e>t.endTime-t.startTime?e:t.endTime-t.startTime,e[0].endTime-e[0].startTime),i=t/e.length;return{duration:t,cues:e.length,shortestCue:r,longestCue:n,averageCue:i}})(this.entries),t=this.text().split(" ").length;return e.wordCount=t,e.wordsPerMinute=parseInt(t/e.duration*60,10),e}lint(e={}){return((e,t={})=>{t.silent=t.silent||!1;let r=[];for(let t=0;t<e.length;t+=1){let n=e[t];n.startTime>=n.endTime&&r.push(`StartTime is greater than EndTime for entry ${t}`),0===n.text.length&&r.push(`Text is empty for entry ${t}`),n.text.length>100&&r.push(`Text is too long for entry ${t}`)}return r.length>0?t.silent||(console.log("Lint errors: "),console.log(r)):t.silent||console.log("No lint errors found"),r})(this.entries,e)}isValid(e={}){return((e,t={})=>{t.silent=t.silent||!1;let r=[];e&&0!==e.length||r.push("No entries found");for(let t=0;t<e.length;t+=1){let n=e[t];("number"!=typeof n.startTime||n.startTime<0)&&r.push(`Invalid start time for entry ${t}`),("number"!=typeof n.endTime||n.endTime<0)&&r.push(`Invalid end time for entry ${t}`),n.startTime>=n.endTime&&r.push(`Start time is greater than end time for entry ${t}`)}return!(r.length>0&&(t.silent||(console.log("\n\n--------------------------------"),console.log("Validation errors: "),console.log(r),console.log("--------------------------------\n\n")),1))})(this.entries,e)}stripXml(){return this.entries=this.entries.map(e=>(e.text=e.text.map(e=>a(e)),e)),this}stripVoice(){return this.entries=this.entries.map(e=>(e.text=e.text.map(e=>function(e){return(e=e.replace(/<v[^>]*>/g,"")).replace(/<\/v>/g,"")}(e)),e)),this}stripLang(){return this.entries=this.entries.map(e=>(e.text=e.text.map(e=>function(e){return(e=e.replace(/<lang[^>]*>/g,"")).replace(/<\/lang>/g,"")}(e)),e)),this}stripStyle(){return this.entries.map(e=>(delete e.attributes,e))}shift(e){return s(this.entries,e)}shiftLeft(e){return s(this.entries,-e)}shiftRight(e){return s(this.entries,e)}sort(){return this.entries.sort((e,t)=>e.startTime-t.startTime)}sceneSplit(e=2){return((e,t=2)=>{const r=[];let n=[];for(let i=0;i<e.length-1;i++){const s=e[i+1];s?s.startTime-e[i].endTime>=t&&n.length>1?(r.push(n),n=[]):n.push(e[i]):n.push(e[i])}return n.length>0&&r.push(n),r})(this.entries,e)}firstCue(){return this.entries[0]}lastCue(){return this.entries[this.entries.length-1]}duration(){return this.lastCue().endTime-this.firstCue().startTime}}const p=function(e=""){return new u(e)};return p.fromElement=function(e){let t=e.querySelector("track");if(!t)throw new Error("No vtt file found");return console.log(t),p(t.textContent)},p});
